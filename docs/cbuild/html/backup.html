<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>备份与恢复 &mdash; ChangMao 16.3.07 文档</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '16.3.07',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="ChangMao 16.3.07 文档" href="index.html" />
    <link rel="prev" title="欢迎使用长矛帮助文档" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="index.html" title="欢迎使用长矛帮助文档"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ChangMao 16.3.07 文档</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>备份与恢复<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>任何人都可能碰到硬件故障和数据丢失的情况。所以定期备份长矛数据是非常关键的。因为如果面临这种情况，会导致包含非常重要且敏感数据的项目丢失数据，从而产生巨大的负面影响。</p>
<p>为了防止数据丢失，应定期备份长矛以便能够:</p>
<ul class="simple">
<li><em>修复长矛副本</em> — — 备份数据有助于修复长矛，这样就不会丢失配置设置和任何项目数据。</li>
<li><em>迁移不同的长矛服务器之间的数据</em> — — 如果遇到任何硬件更改或故障，长矛的多个实例之间的数据传输是非常有利的。</li>
</ul>
<div class="section" id="id2">
<h2>备份数据<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>备份包含所有需要将长矛还原到某个特定的状态，例如应用程序设置和项目。唯一不会迁移的是软件版本。长矛实例将继续使用当前版本。</p>
<p>备份长矛时，所有数据库内容压缩成ZIP文件并存储在 <code class="docutils literal"><span class="pre">/path/to/Changmao/apps/pro/backups</span></code> 路径中。将长矛还原到特定的备份时，不会覆盖这些文件。因此只有手动删除或卸载长矛，他们才可用。</p>
<p>若要备份长矛数据:</p>
<p>1、转到“管理”&#8211;&gt;“全局设置”</p>
<p>2、选择“备份”选项卡</p>
<img alt="_images/1.png" src="_images/1.png" />
<p>3、单击“新的备份”按钮，显示“创建备份”页面</p>
<img alt="_images/2.png" src="_images/2.png" />
<p>4、在“创建备份”的页面中输入备份文件的名称和相应的描述</p>
<img alt="_images/3.png" src="_images/3.png" />
<p>5、单击“创建备份”按钮
提供清晰、简明的描述以便容易标识每份文件的内容。这对还原备份时，有多个可供选择的文件，是有帮助的。
出现备份页面时，可见已创建的备份文件。状态列将显示备份进度。需刷新页面来更新状态。备份完成后，将变为为“完成”状态。</p>
<img alt="_images/4.png" src="_images/4.png" />
</div>
<div class="section" id="id3">
<h2>恢复备份<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>还原将长矛服务器恢复到备份文件你内获取的状态。备份文件是独立的平台，可将数据从一个操作系统还原到另一个没有任何问题的操作系统。</p>
<p>还原备份文件时，备份文件内的数据将覆盖当前长矛实例中的所有内容，包括用户帐户、 报告和日志。所有不在备份文件中的数据将丢失。</p>
<p>要还原备份，则必须停止所有长矛进程以修改数据库。还原数据库后，长矛服务将重启且可像往常一样使用长矛。不用担心。无需手动关闭流程，我们会在运行还原脚本时关闭它。</p>
<p><strong>在Linux系统上恢复</strong></p>
<p>若要还原备份，需从诊断的shell程序运行脚本。</p>
<p>如果正还原Linux系统上的 Windows 备份，需在还原文件前更改可执行的ZIPA文件权限。若要更改文件的权限，请运行以下命令:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo chmod +x /opt/Changmao/apps/pro/backups/&lt;backup file&gt;.zip.
</pre></div>
</div>
<p>若要还原 Linux 系统上的备份:</p>
<p>1、打开终端
2、cd 切换至长矛目录:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd /opt/Changmao
</pre></div>
</div>
<p>3、sudo 运行diagnostic shell:</p>
<div class="highlight-python"><div class="highlight"><pre>/opt/Changmao$ sudo ./diagnostic_shell
</pre></div>
</div>
<p>4、bash命令行出现提示时，运行还原脚本:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">bash</span><span class="o">-</span><span class="mf">4.3</span><span class="c"># ./restore</span>
</pre></div>
</div>
<p>5、如果长矛服务仍在运行，会提示停止运行，输入Y继续。</p>
<img alt="_images/10.png" src="_images/10.png" />
<p>6、当显示备份列表时，请输入需要还原的备份文件名。</p>
<img alt="_images/6.png" src="_images/6.png" />
<p>7、当出现确认消息时，请输入 Y 以还原备份。备份过程可能需要几分钟。完成后，将看到&#8221;恢复完成&#8221;消息。</p>
<p>8、输入 exit 关闭诊断的shell。</p>
<p><strong>还原到长矛较早版本</strong></p>
<p>我们仅支持转发兼容性，这意味着可将备份还原到长矛的相同版本或更新版本的。例如，如果在长矛4.11.6 上创建备份文件，则无法还原较早版本的文件，如长矛4.11.5 。但是可还原到新的版本，如 长矛4.11.7。</p>
<p>要检查备份版本，请转到备份区并在长矛版本列中查找。</p>
<img alt="_images/9.png" src="_images/9.png" />
</div>
<div class="section" id="id4">
<h2>备份后重新登录<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>还原备份文件时，将覆盖包含用户账户在内的所有长矛实例内容。如果已将备份文件还原到不同的长矛实例，可能无法使用之前的凭据登录。如果已恢复备份文件并不再登录到 长矛，则可运行重置密码的脚本获取新凭据。</p>
</div>
<div class="section" id="id5">
<h2>查找备份文件<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>备份文件位于 <code class="docutils literal"><span class="pre">/path/to/Changmao/apps/pro/backups</span></code></p>
<p>若打算卸载 长矛，应将此目录中的备份文件复制到计算机上的不同位置。或如果想与另一个长矛实例共享备份文件，可从此位置复制。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">备份与恢复</a><ul>
<li><a class="reference internal" href="#id2">备份数据</a></li>
<li><a class="reference internal" href="#id3">恢复备份</a></li>
<li><a class="reference internal" href="#id4">备份后重新登录</a></li>
<li><a class="reference internal" href="#id5">查找备份文件</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="index.html"
                        title="上一章">欢迎使用长矛帮助文档</a></p>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/backup.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="转向" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的术语，模块，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="index.html" title="欢迎使用长矛帮助文档"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ChangMao 16.3.07 文档</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; 版权所有 2016, Hoyann.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3 创建。
    </div>
  </body>
</html>